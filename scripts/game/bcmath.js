function bcadd(e,t,n){var r,i,s;if(typeof n=="undefined"){n=libbcmath.scale}n=n<0?0:n;r=libbcmath.bc_init_num();i=libbcmath.bc_init_num();s=libbcmath.bc_init_num();r=libbcmath.php_str2num(e.toString());i=libbcmath.php_str2num(t.toString());s=libbcmath.bc_add(r,i,n);if(s.n_scale>n){s.n_scale=n}return s.toString()}function bcsub(e,t,n){var r,i,s;if(typeof n=="undefined"){n=libbcmath.scale}n=n<0?0:n;r=libbcmath.bc_init_num();i=libbcmath.bc_init_num();s=libbcmath.bc_init_num();r=libbcmath.php_str2num(e.toString());i=libbcmath.php_str2num(t.toString());s=libbcmath.bc_sub(r,i,n);if(s.n_scale>n){s.n_scale=n}return s.toString()}function bccomp(e,t,n){var r,i;if(typeof n=="undefined"){n=libbcmath.scale}n=n<0?0:n;r=libbcmath.bc_init_num();i=libbcmath.bc_init_num();r=libbcmath.bc_str2num(e.toString(),n);i=libbcmath.bc_str2num(t.toString(),n);return libbcmath.bc_compare(r,i,n)}function bcscale(e){e=parseInt(e,10);if(isNaN(e)){return false}if(e<0){return false}libbcmath.scale=e;return true}function bcdiv(e,t,n){var r,i,s;if(typeof n=="undefined"){n=libbcmath.scale}n=n<0?0:n;r=libbcmath.bc_init_num();i=libbcmath.bc_init_num();s=libbcmath.bc_init_num();r=libbcmath.php_str2num(e.toString());i=libbcmath.php_str2num(t.toString());s=libbcmath.bc_divide(r,i,n);if(s===-1){throw new Error(11,"(BC) Division by zero")}if(s.n_scale>n){s.n_scale=n}return s.toString()}function bcmul(e,t,n){var r,i,s;if(typeof n=="undefined"){n=libbcmath.scale}n=n<0?0:n;r=libbcmath.bc_init_num();i=libbcmath.bc_init_num();s=libbcmath.bc_init_num();r=libbcmath.php_str2num(e.toString());i=libbcmath.php_str2num(t.toString());s=libbcmath.bc_multiply(r,i,n);if(s.n_scale>n){s.n_scale=n}return s.toString()}function bcround(e,t){var n;n="0."+Array(t+1).join("0")+"5";if(e.toString().substring(0,1)=="-"){n="-"+n}r=bcadd(e,n,t);return r}function DecimalNumber(e,t){if(typeof t=="undefined"){t=0}if(typeof e=="undefined"){e="0"}this.getPi=function(e){if(e>37){alert("Note: this approximation is not accurate above 37 decimal places")}return bcdiv("2646693125139304345","842468587426513207",e)};this.toString=function(){return this._result};this.floor=function(e){this._result=bcadd(this._result,"0",0);return this};this.ceil=function(e){if(this._result.substr(0,1)=="-"){this._result=bcround(bcadd(this._result,"-0.5",1),0)}else{this._result=bcround(bcadd(this._result,"0.5",1),0)}return this};this.toFixed=function(e){return bcround(this._result,e)};this.valueOf=function(){return this._result};this.abs=function(){if(this._result.substr(0,1)=="-"){this._result=this._result.substr(1,this._result.length-1)}return this};this.toInt=function(){return parseInt(this.toFixed(0))};this.toFloat=function(){return parseFloat(this._result)};this.add=function(e){this._result=bcround(bcadd(this._result,this._parseNumber(e),this._precision+2),this._precision);return this};this.sub=function(e){return this.subtract(e)};this.subtract=function(e){this._result=bcround(bcsub(this._result,this._parseNumber(e),this._precision+2),this._precision);return this};this.mul=function(e){return this.multiply(e)};this.multiply=function(e){this._result=bcround(bcmul(this._result,this._parseNumber(e),this._precision+2),this._precision);return this};this.div=function(e){return this.divide(e)};this.divide=function(e){this._result=bcround(bcdiv(this._result,this._parseNumber(e),this._precision+2),this._precision);return this};this.round=function(e){this._result=bcround(this._result,e);return this};this.setPrecision=function(e){this._precision=e;this.round(e);return this};this._parseNumber=function(e){var t,n;t=e.toString().replace(/[^0-9\-\.]/g,"");if(t===""){return"0"}return t};this.reset=function(e){if(typeof e=="undefined"){e=0}this._result=bcround(e,this._precision);return this};this._precision=t;this._result=bcround(this._parseNumber(e),this._precision)}function TestFloatingPointProblems(){var e=0;e+=.1;e+=.7;e=e*10;e=Math.floor(e).toString();if(e==="8"){alert("Wow! Result is correct, your browser doesn't have the floating point problems... cool :)")}else{alert("Well, apparently your browser can't work out Floor((0.1 + 0.7) * 10).. it thinks the answer is: "+e+", the correct answer is of course 8.")}var t=(new DecimalNumber(0,1)).add("0.1").add("0.7").multiply("10").floor().toString();if(t==="8"){alert("Howver, The DecimalNumber Library worked it out fine.. it figured out the maths as expected :)")}else{alert("Odd, apparently the DecimalNumber library can't work it out either.. must be a problem somewhere :/")}var n=(0x24baf15fe1659000/0xbb10cb777fb8100).toFixed(20);if(n=="3.14159265358979323846"){alert("Your browser calculates PI correctly to 20dp.. well done")}else{alert("Your browser calculates PI WRONG.. it is.. "+bcsub("3.14159265358979323846",n,20)+" off at 20dp")}var r=new DecimalNumber(0,20);r=r.reset("2646693125139304345").divide("842468587426513207").toString();if(r=="3.14159265358979323846"){alert("The DecimalNumber Library calculates PI correctly to 20dp... of course :)")}else{alert("Odd, the DecimalNumber Library calculated PI WRONG.. it is.."+bcsub("3.14159265358979323846",n,20)+" off at 20dp")}var r=new DecimalNumber(0,38);r=r.reset("2646693125139304345").divide("842468587426513207").toString();if(r=="3.14159265358979323846264338327950288418"){alert("The DecimalNumber Library calculates PI correctly to 38dp... of course :)")}else{alert("Odd, the DecimalNumber Library calculated PI WRONG.. it is.."+bcsub("3.14159265358979323846264338327950288418",r,38)+" off at 38dp")}var r=new DecimalNumber;r.getPi(1e6);r=null;alert("done")}var libbcmath={PLUS:"+",MINUS:"-",BASE:10,scale:0,bc_num:function(){this.n_sign=null;this.n_len=null;this.n_scale=null;this.n_value=null;this.toString=function(){var e,t;t=this.n_value.join("");e=(this.n_sign==libbcmath.PLUS?"":this.n_sign)+t.substr(0,this.n_len);if(this.n_scale>0){e+="."+t.substr(this.n_len,this.n_scale)}return e}},bc_new_num:function(e,t){var n;n=new libbcmath.bc_num;n.n_sign=libbcmath.PLUS;n.n_len=e;n.n_scale=t;n.n_value=libbcmath.safe_emalloc(1,e+t,0);libbcmath.memset(n.n_value,0,0,e+t);return n},safe_emalloc:function(e,t,n){return Array(e*t+n)},bc_init_num:function(){return new libbcmath.bc_new_num(1,0)},_bc_rm_leading_zeros:function(e){while(e.n_value[0]===0&&e.n_len>1){e.n_value.shift();e.n_len--}},php_str2num:function(e){var t;t=e.indexOf(".");if(t==-1){return libbcmath.bc_str2num(e,0)}else{return libbcmath.bc_str2num(e,e.length-t)}},CH_VAL:function(e){return e-"0"},BCD_CHAR:function(e){return e+"0"},isdigit:function(e){return isNaN(parseInt(e,10))?false:true},bc_str2num:function(e,t){var n,r,i,s,o,u,a;n=e.split("");i=0;s=0;o=0;u=false;if(n[i]==="+"||n[i]==="-"){i++}while(n[i]==="0"){i++}while(n[i]%1===0){i++;s++}if(n[i]==="."){i++}while(n[i]%1===0){i++;o++}if(n[i]||s+o===0){return libbcmath.bc_init_num()}o=libbcmath.MIN(o,t);if(s===0){u=true;s=1}r=libbcmath.bc_new_num(s,o);i=0;if(n[i]==="-"){r.n_sign=libbcmath.MINUS;i++}else{r.n_sign=libbcmath.PLUS;if(n[i]==="+"){i++}}while(n[i]==="0"){i++}a=0;if(u){r.n_value[a++]=0;s=0}for(;s>0;s--){r.n_value[a++]=libbcmath.CH_VAL(n[i++])}if(o>0){i++;for(;o>0;o--){r.n_value[a++]=libbcmath.CH_VAL(n[i++])}}return r},cint:function(e){if(typeof e=="undefined"){e=0}var t=parseInt(e,10);if(isNaN(t)){t=0}return t},MIN:function(e,t){return e>t?t:e},MAX:function(e,t){return e>t?e:t},ODD:function(e){return e&1},memset:function(e,t,n,r){var i;for(i=0;i<r;i++){e[t+i]=n}},memcpy:function(e,t,n,r,i){var s;for(s=0;s<i;s++){e[t+s]=n[r+s]}return true},bc_is_zero:function(e){var t;var n;t=e.n_len+e.n_scale;n=0;while(t>0&&e.n_value[n++]===0){t--}if(t!==0){return false}else{return true}},bc_out_of_memory:function(){throw new Error("(BC) Out of memory")}};libbcmath.bc_add=function(e,t,n){var r,i,s;if(e.n_sign===t.n_sign){r=libbcmath._bc_do_add(e,t,n);r.n_sign=e.n_sign}else{i=libbcmath._bc_do_compare(e,t,false,false);switch(i){case-1:r=libbcmath._bc_do_sub(t,e,n);r.n_sign=t.n_sign;break;case 0:s=libbcmath.MAX(n,libbcmath.MAX(e.n_scale,t.n_scale));r=libbcmath.bc_new_num(1,s);libbcmath.memset(r.n_value,0,0,s+1);break;case 1:r=libbcmath._bc_do_sub(e,t,n);r.n_sign=e.n_sign}}return r};libbcmath.bc_compare=function(e,t){return libbcmath._bc_do_compare(e,t,true,false)};libbcmath._bc_do_compare=function(e,t,n,r){var i,s;var o;if(n&&e.n_sign!=t.n_sign){if(e.n_sign==libbcmath.PLUS){return 1}else{return-1}}if(e.n_len!=t.n_len){if(e.n_len>t.n_len){if(!n||e.n_sign==libbcmath.PLUS){return 1}else{return-1}}else{if(!n||e.n_sign==libbcmath.PLUS){return-1}else{return 1}}}o=e.n_len+Math.min(e.n_scale,t.n_scale);i=0;s=0;while(o>0&&e.n_value[i]==t.n_value[s]){i++;s++;o--}if(r&&o==1&&e.n_scale==t.n_scale){return 0}if(o!==0){if(e.n_value[i]>t.n_value[s]){if(!n||e.n_sign==libbcmath.PLUS){return 1}else{return-1}}else{if(!n||e.n_sign==libbcmath.PLUS){return-1}else{return 1}}}if(e.n_scale!=t.n_scale){if(e.n_scale>t.n_scale){for(o=e.n_scale-t.n_scale;o>0;o--){if(e.n_value[i++]!==0){if(!n||e.n_sign==libbcmath.PLUS){return 1}else{return-1}}}}else{for(o=t.n_scale-e.n_scale;o>0;o--){if(t.n_value[s++]!==0){if(!n||e.n_sign==libbcmath.PLUS){return-1}else{return 1}}}}}return 0};libbcmath._one_mult=function(e,t,n,r,i,s){var o,u;var a,f;if(r===0){libbcmath.memset(i,0,0,n)}else{if(r==1){libbcmath.memcpy(i,s,e,t,n)}else{a=t+n-1;f=s+n-1;o=0;while(n-->0){u=e[a--]*r+o;i[f--]=u%libbcmath.BASE;o=Math.floor(u/libbcmath.BASE)}if(o!=0){i[f]=o}}}};libbcmath.bc_divide=function(e,t,n){var r;var i;var s,o;var u,a,f,l;var c,h;var p,d,v,m,g,y;var b,w,E,S;var x;var T;var N;var C;if(libbcmath.bc_is_zero(t)){return-1}if(libbcmath.bc_is_zero(e)){return libbcmath.bc_new_num(1,n)}if(t.n_scale===0){if(t.n_len===1&&t.n_value[0]===1){i=libbcmath.bc_new_num(e.n_len,n);i.n_sign=e.n_sign==t.n_sign?libbcmath.PLUS:libbcmath.MINUS;libbcmath.memset(i.n_value,e.n_len,0,n);libbcmath.memcpy(i.n_value,0,e.n_value,0,e.n_len+libbcmath.MIN(e.n_scale,n))}}v=t.n_scale;f=t.n_len+v-1;while(v>0&&t.n_value[f--]===0){v--}p=e.n_len+v;c=e.n_scale-v;if(c<n){g=n-c}else{g=0}s=libbcmath.safe_emalloc(1,e.n_len+e.n_scale,g+2);if(s===null){libbcmath.bc_out_of_memory()}libbcmath.memset(s,0,0,e.n_len+e.n_scale+g+2);libbcmath.memcpy(s,1,e.n_value,0,e.n_len+e.n_scale);d=t.n_len+v;o=libbcmath.safe_emalloc(1,d,1);if(o===null){libbcmath.bc_out_of_memory()}libbcmath.memcpy(o,0,t.n_value,0,d);o[d]=0;f=0;while(o[f]===0){f++;d--}if(d>p+n){m=n+1;T=true}else{T=false;if(d>p){m=n+1}else{m=p-d+n+1}}i=libbcmath.bc_new_num(m-n,n);libbcmath.memset(i.n_value,0,0,m);x=libbcmath.safe_emalloc(1,d,1);if(x===null){libbcmath.bc_out_of_memory()}if(!T){N=Math.floor(10/(t.n_value[f]+1));if(N!=1){libbcmath._one_mult(s,0,p+c+g+1,N,s,0);libbcmath._one_mult(t.n_value,f,d,N,t.n_value,f)}b=0;if(d>p){l=d-p}else{l=0}while(b<=p+n-d){if(t.n_value[f]==s[b]){w=9}else{w=Math.floor((s[b]*10+s[b+1])/t.n_value[f])}if(t.n_value[f+1]*w>(s[b]*10+s[b+1]-t.n_value[f]*w)*10+s[b+2]){w--;if(t.n_value[f+1]*w>(s[b]*10+s[b+1]-t.n_value[f]*w)*10+s[b+2]){w--}}E=0;if(w!==0){x[0]=0;libbcmath._one_mult(t.n_value,f,d,w,x,1);u=b+d;a=d;for(y=0;y<d+1;y++){if(a<0){h=s[u]-0-E}else{h=s[u]-x[a--]-E}if(h<0){h+=10;E=1}else{E=0}s[u--]=h}}if(E==1){w--;u=b+d;a=d-1;S=0;for(y=0;y<d;y++){if(a<0){h=s[u]+0+S}else{h=s[u]+t.n_value[a--]+S}if(h>9){h-=10;S=1}else{S=0}s[u--]=h}if(S==1){s[u]=(s[u]+1)%10}}i.n_value[l++]=w;b++}}i.n_sign=e.n_sign==t.n_sign?libbcmath.PLUS:libbcmath.MINUS;if(libbcmath.bc_is_zero(i)){i.n_sign=libbcmath.PLUS}libbcmath._bc_rm_leading_zeros(i);return i};libbcmath._bc_do_add=function(e,t,n){var r;var i,s;var o,u,a;var f,l,c;var h;i=libbcmath.MAX(e.n_scale,t.n_scale);s=libbcmath.MAX(e.n_len,t.n_len)+1;r=libbcmath.bc_new_num(s,libbcmath.MAX(i,n));l=e.n_scale;c=t.n_scale;o=e.n_len+l-1;u=t.n_len+c-1;a=i+s-1;if(l!=c){if(l>c){while(l>c){r.n_value[a--]=e.n_value[o--];l--}}else{while(c>l){r.n_value[a--]=t.n_value[u--];c--}}}l+=e.n_len;c+=t.n_len;f=0;while(l>0&&c>0){h=e.n_value[o--]+t.n_value[u--]+f;if(h>=libbcmath.BASE){f=1;h-=libbcmath.BASE}else{f=0}r.n_value[a]=h;a--;l--;c--}if(l===0){while(c-->0){h=t.n_value[u--]+f;if(h>=libbcmath.BASE){f=1;h-=libbcmath.BASE}else{f=0}r.n_value[a--]=h}}else{while(l-->0){h=e.n_value[o--]+f;if(h>=libbcmath.BASE){f=1;h-=libbcmath.BASE}else{f=0}r.n_value[a--]=h}}if(f==1){r.n_value[a]+=1}libbcmath._bc_rm_leading_zeros(r);return r};libbcmath._bc_do_sub=function(e,t,n){var r;var i,s;var o,u;var a,f,l;var c,h,p;s=libbcmath.MAX(e.n_len,t.n_len);i=libbcmath.MAX(e.n_scale,t.n_scale);u=libbcmath.MIN(e.n_len,t.n_len);o=libbcmath.MIN(e.n_scale,t.n_scale);r=libbcmath.bc_new_num(s,libbcmath.MAX(i,n));a=e.n_len+e.n_scale-1;f=t.n_len+t.n_scale-1;l=s+i-1;c=0;if(e.n_scale!=o){for(h=e.n_scale-o;h>0;h--){r.n_value[l--]=e.n_value[a--]}}else{for(h=t.n_scale-o;h>0;h--){p=0-t.n_value[f--]-c;if(p<0){p+=libbcmath.BASE;c=1}else{c=0;r.n_value[l--]=p}}}for(h=0;h<u+o;h++){p=e.n_value[a--]-t.n_value[f--]-c;if(p<0){p+=libbcmath.BASE;c=1}else{c=0}r.n_value[l--]=p}if(s!=u){for(h=s-u;h>0;h--){p=e.n_value[a--]-c;if(p<0){p+=libbcmath.BASE;c=1}else{c=0}r.n_value[l--]=p}}libbcmath._bc_rm_leading_zeros(r);return r};libbcmath.MUL_BASE_DIGITS=80;libbcmath.MUL_SMALL_DIGITS=libbcmath.MUL_BASE_DIGITS/4;libbcmath.bc_multiply=function(e,t,n){var r;var i,s;var o,u;i=e.n_len+e.n_scale;s=t.n_len+t.n_scale;o=e.n_scale+t.n_scale;u=libbcmath.MIN(o,libbcmath.MAX(n,libbcmath.MAX(e.n_scale,t.n_scale)));r=libbcmath._bc_rec_mul(e,i,t,s,o);r.n_sign=e.n_sign==t.n_sign?libbcmath.PLUS:libbcmath.MINUS;r.n_len=s+i+1-o;r.n_scale=u;libbcmath._bc_rm_leading_zeros(r);if(libbcmath.bc_is_zero(r)){r.n_sign=libbcmath.PLUS}return r};libbcmath.new_sub_num=function(e,t,n){var r=new libbcmath.bc_num;r.n_sign=libbcmath.PLUS;r.n_len=e;r.n_scale=t;r.n_value=n;return r};libbcmath._bc_simp_mul=function(e,t,n,r,i){var s;var o,u,a;var f,l;var c,h,p;p=t+r+1;s=libbcmath.bc_new_num(p,0);f=t-1;l=r-1;a=p-1;h=0;for(c=0;c<p-1;c++){o=f-libbcmath.MAX(0,c-r+1);u=l-libbcmath.MIN(c,r-1);while(o>=0&&u<=l){h+=e.n_value[o--]*n.n_value[u++]}s.n_value[a--]=Math.floor(h%libbcmath.BASE);h=Math.floor(h/libbcmath.BASE)}s.n_value[a]=h;return s};libbcmath._bc_shift_addsub=function(e,t,n,r){var i,s;var o,u;o=t.n_len;if(t.n_value[0]===0){o--}if(!(e.n_len+e.n_scale>=n+o)){throw new Error("len + scale < shift + count")}i=e.n_len+e.n_scale-n-1;s=t.n_len=1;u=0;if(r){while(o--){e.n_value[i]-=t.n_value[s--]+u;if(e.n_value[i]<0){u=1;e.n_value[i--]+=libbcmath.BASE}else{u=0;i--}}while(u){e.n_value[i]-=u;if(e.n_value[i]<0){e.n_value[i--]+=libbcmath.BASE}else{u=0}}}else{while(o--){e.n_value[i]+=t.n_value[s--]+u;if(e.n_value[i]>libbcmath.BASE-1){u=1;e.n_value[i--]-=libbcmath.BASE}else{u=0;i--}}while(u){e.n_value[i]+=u;if(e.n_value[i]>libbcmath.BASE-1){e.n_value[i--]-=libbcmath.BASE}else{u=0}}}return true};libbcmath._bc_rec_mul=function(e,t,n,r,i){var s;var o,u,a,f;var l,c;var h,p,d,v,m;var g,y,b;var w,E;if(t+r<libbcmath.MUL_BASE_DIGITS||t<libbcmath.MUL_SMALL_DIGITS||r<libbcmath.MUL_SMALL_DIGITS){return libbcmath._bc_simp_mul(e,t,n,r,i)}g=Math.floor((libbcmath.MAX(t,r)+1)/2);if(t<g){u=libbcmath.bc_init_num();o=libbcmath.new_sub_num(t,0,e.n_value)}else{u=libbcmath.new_sub_num(t-g,0,e.n_value);o=libbcmath.new_sub_num(g,0,e.n_value+t-g)}if(r<g){f=libbcmath.bc_init_num();a=libbcmath.new_sub_num(r,0,n.n_value)}else{f=libbcmath.new_sub_num(r-g,0,n.n_value);a=libbcmath.new_sub_num(g,0,n.n_value+r-g)}libbcmath._bc_rm_leading_zeros(u);libbcmath._bc_rm_leading_zeros(o);l=o.n_len;libbcmath._bc_rm_leading_zeros(f);libbcmath._bc_rm_leading_zeros(a);c=a.n_len;b=libbcmath.bc_is_zero(u)||libbcmath.bc_is_zero(f);v=libbcmath.bc_init_num();m=libbcmath.bc_init_num();v=libbcmath.bc_sub(u,o,0);w=v.n_len;m=libbcmath.bc_sub(a,f,0);E=m.n_len;if(b){h=libbcmath.bc_init_num()}else{h=libbcmath._bc_rec_mul(u,u.n_len,f,f.n_len,0)}if(libbcmath.bc_is_zero(v)||libbcmath.bc_is_zero(m)){p=libbcmath.bc_init_num()}else{p=libbcmath._bc_rec_mul(v,w,m,E,0)}if(libbcmath.bc_is_zero(o)||libbcmath.bc_is_zero(a)){d=libbcmath.bc_init_num()}else{d=libbcmath._bc_rec_mul(o,o.n_len,a,a.n_len,0)}y=t+r+1;s=libbcmath.bc_new_num(y,0);if(!b){libbcmath._bc_shift_addsub(s,h,2*g,0);libbcmath._bc_shift_addsub(s,h,g,0)}libbcmath._bc_shift_addsub(s,d,g,0);libbcmath._bc_shift_addsub(s,d,0,0);libbcmath._bc_shift_addsub(s,p,g,v.n_sign!=m.n_sign);return s};libbcmath.bc_sub=function(e,t,n){var r;var i,s;if(e.n_sign!=t.n_sign){r=libbcmath._bc_do_add(e,t,n);r.n_sign=e.n_sign}else{i=libbcmath._bc_do_compare(e,t,false,false);switch(i){case-1:r=libbcmath._bc_do_sub(t,e,n);r.n_sign=t.n_sign==libbcmath.PLUS?libbcmath.MINUS:libbcmath.PLUS;break;case 0:s=libbcmath.MAX(n,libbcmath.MAX(e.n_scale,t.n_scale));r=libbcmath.bc_new_num(1,s);libbcmath.memset(r.n_value,0,0,s+1);break;case 1:r=libbcmath._bc_do_sub(e,t,n);r.n_sign=e.n_sign;break}}return r};